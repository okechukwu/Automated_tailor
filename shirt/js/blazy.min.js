/*
  hey, [be]Lazy.js - v1.3.1 - 2015.02.01
  A lazy loading and multi-serving image script
  (c) Bjoern Klinggaard - @bklinggaard - http://dinbror.dk/blazy
*/
(function(b,a){"function"===typeof define&&define.amd?define(a):"object"===typeof exports?module.exports=a():b.Blazy=a()})(this,function(){function K(a){if(!document.querySelectorAll){var d=document.createStyleSheet();document.querySelectorAll=function(h,k,m,n,l){l=document.all;k=[];h=h.replace(/\[for\b/gi,"[htmlFor").split(",");for(m=h.length;m--;){d.addRule(h[m],"k:v");for(n=l.length;n--;){l[n].currentStyle.k&&k.push(l[n])}d.removeRule(0)}return k}}E=!0;G=[];J={};L=a||{};L.error=L.error||!1;L.offset=L.offset||100;L.success=L.success||!1;L.selector=L.selector||".b-lazy";L.separator=L.separator||"|";L.container=L.container?document.querySelectorAll(L.container):!1;L.errorClass=L.errorClass||"b-error";L.breakpoints=L.breakpoints||!1;L.successClass=L.successClass||"b-loaded";L.src=A=L.src||"data-src";o=1<window.devicePixelRatio;J.top=0-L.offset;J.left=0-L.offset;I=j(i,25);s=j(g,50);g();D(L.breakpoints,function(e){if(e.width>=window.screen.width){return A=e.src,!1}});H()}function H(){c(L.selector);E&&(E=!1,L.container&&D(L.container,function(a){C(a,"scroll",I)}),C(window,"resize",s),C(window,"resize",I),C(window,"scroll",I));i()}function i(){for(var a=0;a<F;a++){var d=G[a],e=d.getBoundingClientRect();if(e.right>=J.left&&e.bottom>=J.top&&e.left<=J.right&&e.top<=J.bottom||-1!==(" "+d.className+" ").indexOf(" "+L.successClass+" ")){K.prototype.load(d),G.splice(a,1),F--,a--}}0===F&&K.prototype.destroy()}function b(a,e){if(e||0<a.offsetWidth&&0<a.offsetHeight){var h=a.getAttribute(A)||a.getAttribute(L.src);if(h){var h=h.split(L.separator),f=h[o&&1<h.length?1:0],h=new Image;D(L.breakpoints,function(d){a.removeAttribute(d.src)});a.removeAttribute(L.src);h.onerror=function(){L.error&&L.error(a,"invalid");a.className=a.className+" "+L.errorClass};h.onload=function(){"img"===a.nodeName.toLowerCase()?a.src=f:a.style.backgroundImage='url("'+f+'")';a.className=a.className+" "+L.successClass;L.success&&L.success(a)};h.src=f}else{L.error&&L.error(a,"missing"),a.className=a.className+" "+L.errorClass}}}function c(d){d=document.querySelectorAll(d);for(var e=F=d.length;e--;G.unshift(d[e])){}}function g(){J.bottom=(window.innerHeight||document.documentElement.clientHeight)+L.offset;J.right=(window.innerWidth||document.documentElement.clientWidth)+L.offset}function C(d,e,f){d.attachEvent?d.attachEvent&&d.attachEvent("on"+e,f):d.addEventListener(e,f,!1)}function B(d,e,f){d.detachEvent?d.detachEvent&&d.detachEvent("on"+e,f):d.removeEventListener(e,f,!1)}function D(f,k){if(f&&k){for(var l=f.length,h=0;h<l&&!1!==k(f[h],h);h++){}}}function j(e,f){var h=0;return function(){var a=+new Date;a-h<f||(h=a,e.apply(G,arguments))}}var A,L,J,G,F,o,E,I,s;K.prototype.revalidate=function(){H()};K.prototype.load=function(a,e){-1===(" "+a.className+" ").indexOf(" "+L.successClass+" ")&&b(a,e)};K.prototype.destroy=function(){L.container&&D(L.container,function(d){B(d,"scroll",I)});B(window,"scroll",I);B(window,"resize",I);B(window,"resize",s);F=0;G.length=0;E=!0};return K});